{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://observability-hub.com/schemas/trace-event.schema.json",
  "title": "Trace Event Schema",
  "description": "Schema for distributed tracing events in the observability system",
  "allOf": [
    {
      "$ref": "base-event.schema.json"
    },
    {
      "type": "object",
      "properties": {
        "eventType": {
          "type": "string",
          "pattern": "^trace\\.(span)\\.(started|finished|created|updated)$"
        },
        "data": {
          "type": "object",
          "required": ["traceId", "spanId", "operationName", "startTime"],
          "properties": {
            "traceId": {
              "type": "string",
              "pattern": "^[a-f0-9]{32}$|^[a-f0-9]{16}$",
              "description": "Unique identifier for the entire trace"
            },
            "spanId": {
              "type": "string",
              "pattern": "^[a-f0-9]{16}$",
              "description": "Unique identifier for this span"
            },
            "parentSpanId": {
              "type": "string",
              "pattern": "^[a-f0-9]{16}$",
              "description": "Parent span identifier"
            },
            "operationName": {
              "type": "string",
              "minLength": 1,
              "maxLength": 255,
              "description": "Name of the operation being traced"
            },
            "startTime": {
              "type": "string",
              "format": "date-time",
              "description": "When the span started"
            },
            "endTime": {
              "type": "string",
              "format": "date-time",
              "description": "When the span ended"
            },
            "duration": {
              "type": "integer",
              "minimum": 0,
              "description": "Span duration in microseconds"
            },
            "status": {
              "type": "object",
              "required": ["code"],
              "properties": {
                "code": {
                  "type": "string",
                  "enum": ["OK", "CANCELLED", "UNKNOWN", "INVALID_ARGUMENT", 
                           "DEADLINE_EXCEEDED", "NOT_FOUND", "ALREADY_EXISTS", 
                           "PERMISSION_DENIED", "RESOURCE_EXHAUSTED", "FAILED_PRECONDITION",
                           "ABORTED", "OUT_OF_RANGE", "UNIMPLEMENTED", "INTERNAL",
                           "UNAVAILABLE", "DATA_LOSS", "UNAUTHENTICATED"],
                  "description": "Span status code following gRPC conventions"
                },
                "message": {
                  "type": "string",
                  "description": "Status message"
                }
              },
              "additionalProperties": false
            },
            "kind": {
              "type": "string",
              "enum": ["INTERNAL", "SERVER", "CLIENT", "PRODUCER", "CONSUMER"],
              "description": "Span kind indicating the type of span"
            },
            "tags": {
              "type": "object",
              "additionalProperties": {
                "oneOf": [
                  {"type": "string"},
                  {"type": "number"},
                  {"type": "boolean"}
                ]
              },
              "description": "Span tags/attributes for additional metadata"
            },
            "logs": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["timestamp"],
                "properties": {
                  "timestamp": {
                    "type": "string",
                    "format": "date-time"
                  },
                  "fields": {
                    "type": "object",
                    "additionalProperties": {
                      "oneOf": [
                        {"type": "string"},
                        {"type": "number"},
                        {"type": "boolean"}
                      ]
                    }
                  }
                }
              },
              "description": "Structured logs within the span"
            },
            "process": {
              "type": "object",
              "required": ["serviceName"],
              "properties": {
                "serviceName": {
                  "type": "string",
                  "minLength": 1,
                  "description": "Service name"
                },
                "tags": {
                  "type": "object",
                  "additionalProperties": {"type": "string"},
                  "description": "Process-level tags"
                }
              }
            },
            "references": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["refType", "traceId", "spanId"],
                "properties": {
                  "refType": {
                    "type": "string",
                    "enum": ["CHILD_OF", "FOLLOWS_FROM"],
                    "description": "Type of reference"
                  },
                  "traceId": {
                    "type": "string",
                    "pattern": "^[a-f0-9]{32}$|^[a-f0-9]{16}$"
                  },
                  "spanId": {
                    "type": "string",
                    "pattern": "^[a-f0-9]{16}$"
                  }
                }
              },
              "description": "References to other spans"
            }
          },
          "additionalProperties": false
        }
      }
    }
  ]
} 